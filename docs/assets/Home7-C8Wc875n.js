import{bS as Z,r as h,w as V,c as tt,av as at,o as et,cn as ot,N as z,B as m,u as r,cj as st,s as c,v as l,x as nt,an as it,A as L,ap as rt,aq as R,p as u,q as x,X,V as k,O as lt}from"./index-DUkU98TY.js";import{o as J}from"./overflowText-MHgtVsfW.js";import{T as ct}from"./v-scale-screen-C8hdMqua.js";import{g as dt,u as ht}from"./cover-DzIuO3oK.js";import{_ as ut}from"./plugin-vueexport-helper-DlAUqK2U.js";const gt={class:"surface-container"},mt={class:"rain-container"},vt={key:1,class:"separate"},yt={key:3},ft={class:"original"},pt={class:"translated"},kt={key:1,class:"lyric-empty"},_t={class:"street-light"},Ct={class:"top"},U="80px",Dt="65px",Y="50px",St={__name:"Home7",setup(wt){st(a=>({"115da5fa":U,"18f9e78a":Dt,"317d6781":Y}));const o=Z(),I=h(localStorage.getItem("backgroundColor")||"rgba(0, 0, 0, 0.8)"),v=h(localStorage.getItem("textColor")||"rgba(255, 255, 255, 1)"),H=h(localStorage.getItem("shadowColor")||"rgba(255, 255, 255, 1)"),B=h([]);class G{constructor(t,e){this.canvasWidth=t,this.canvasHeight=e,this.reset()}reset(){this.y=Math.random()*-this.canvasHeight,g.value.angle>=0?this.x=(Math.random()*1.2-.2)*this.canvasWidth:this.x=Math.random()*1.2*this.canvasWidth,this.length=Math.random()*10+30,this.width=Math.random()*1+3,this.speedFactor=Math.random()*.5+.7}update(t,e){const s=t*Math.PI/180,i=Math.sin(s)*e,n=Math.cos(s)*e*this.speedFactor;this.x+=i,this.y+=n,this.y>this.canvasHeight+30&&this.reset()}draw(t,e){const s=e*Math.PI/180,i=this.x-Math.sin(s)*this.length,n=this.y-Math.cos(s)*this.length,d=t.createLinearGradient(this.x,this.y,i,n);d.addColorStop(0,I.value),d.addColorStop(1,"rgba(255, 255, 255, 0)"),t.beginPath(),t.moveTo(this.x,this.y),t.lineTo(i,n),t.strokeStyle=d,t.lineWidth=this.width,t.stroke()}}const y=h(null);let M=null,_=[],C=null;const g=h(JSON.parse(localStorage.getItem("rainConfig")||{isRain:!0,amount:100,angle:0,speed:10})),K=()=>{var e,s;const a=new ht,t=new Image;t.src=dt((s=(e=o.songData)==null?void 0:e.track)==null?void 0:s.cover),t.onload=function(){const i=a.getColor(t);I.value="rgba(".concat(i.join(","),", 1)"),v.value="rgba(".concat(i.map(n=>255-n).join(","),", 1)"),H.value="rgba(".concat(i.map(n=>255-n).join(","),", 1)"),B.value=a.getPalette(t).map(n=>"rgba(".concat(n.join(","),", 1)"))}};JSON.parse(localStorage.getItem("isCustomColor"))||V(()=>{var a,t;return(t=(a=o.songData)==null?void 0:a.track)==null?void 0:t.cover},(a,t)=>{a&&a!==t&&K()});const D=tt(()=>{var s,i;const a=((i=(s=o.songData)==null?void 0:s.player)==null?void 0:i.seekbarCurrentPositionHuman.split(":"))||0,t=parseInt(a[0])*60+parseInt(a[1]);let e=-1;for(let n=o.lyricData.lyric.length-1;n>=0;n--){const d=o.lyricData.lyric[n][1].match(/\[(\d+):(\d+)\.(\d+)\]/);if(d){const b=parseInt(d[1])*60+parseInt(d[2]);if(t>=b){e=n;break}}}return e}),S=h(""),w=h(""),N=h(null);V(D,(a,t)=>{if(o.lyricData.translatedLyric.length>0)if(a===-1)S.value="",w.value="";else{let e=o.lyricData.lyric[a][1],s=o.lyricData.translatedLyric.find(i=>i[1]===e);s&&s[2]?(w.value=s[2],S.value=o.lyricData.lyric[a][2]):(w.value=o.lyricData.lyric[a][2],S.value="")}}),at({status:"已暂停",name:"暂无歌曲"}),et(()=>{o.resetSongData();const a=y.value;M=a.getContext("2d"),T(a),Q(a),C=requestAnimationFrame(F);let t=null;window.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>{T(y.value)},200)})}),ot(()=>{C&&cancelAnimationFrame(C),window.removeEventListener("resize",()=>T(y.value))});function T(a){let t=document.querySelector(".rain-container");a.width=t.clientWidth,a.height=t.clientHeight,_.forEach(e=>{e.canvasWidth=a.width,e.canvasHeight=a.height})}function Q(a){_=[];for(let t=0;t<g.value.amount;t++)_.push(new G(a.width,a.height))}function F(){const a=y.value;M.clearRect(0,0,a.width,a.height),_.forEach(t=>{t.update(g.value.angle,g.value.speed),t.draw(M,g.value.angle)}),C=requestAnimationFrame(F)}return(a,t)=>(c(),z(r(ct),{width:1900,height:800,"box-style":{backgroundColor:"none"}},{default:m(()=>[l("div",{class:"main",style:nt({"--theme-color":I.value,"--text-color":v.value,"--bg-color":B.value[2]||v.value,"--shadow-color":H.value})},[l("div",gt,[l("div",mt,[it(l("canvas",{id:"rainCanvas",ref_key:"rainCanvas",ref:y},null,512),[[rt,g.value.isRain]]),L(R,{name:"lyric",mode:"out-in"},{default:m(()=>{var e,s,i,n,d,b,W,j,q,E,P,A,$,O;return[(c(),u("div",{class:"song-container",key:(s=(e=r(o).songData)==null?void 0:e.track)==null?void 0:s.title},[(n=(i=r(o).songData)==null?void 0:i.track)!=null&&n.title?(c(),z(J,{key:0,color:v.value,"font-size":U,"is-bold":"bold"},{default:m(()=>{var f,p;return[X(k((p=(f=r(o).songData)==null?void 0:f.track)==null?void 0:p.title),1)]}),_:1},8,["color"])):x("",!0),(b=(d=r(o).songData)==null?void 0:d.track)!=null&&b.title&&((j=(W=r(o).songData)==null?void 0:W.track)!=null&&j.author)?(c(),u("span",vt,"-")):x("",!0),(E=(q=r(o).songData)==null?void 0:q.track)!=null&&E.author?(c(),z(J,{key:2,color:v.value,"font-size":Y,"is-bold":"bold"},{default:m(()=>{var f,p;return[X(k((p=(f=r(o).songData)==null?void 0:f.track)==null?void 0:p.author),1)]}),_:1},8,["color"])):x("",!0),!((A=(P=r(o).songData)==null?void 0:P.track)!=null&&A.title)&&!((O=($=r(o).songData)==null?void 0:$.track)!=null&&O.author)?(c(),u("span",yt,"暂无歌曲信息")):x("",!0)]))]}),_:1}),L(R,{name:"lyric",mode:"out-in"},{default:m(()=>{var e;return[(c(),u("div",{class:"lyric-container",key:D.value},[r(o).lyricData.lyric.length>0?(c(),u(lt,{key:0},[r(o).lyricData.translatedLyric.length===0?(c(),u("span",{key:0,ref_key:"lyricRef",ref:N,class:"lyric-line"},k(((e=r(o).lyricData.lyric[D.value])==null?void 0:e.length)>0&&r(o).lyricData.lyric[D.value][2]||"......"),513)):(c(),u("div",{key:1,ref_key:"lyricRef",ref:N,class:"lyric-line-translated"},[l("span",ft,k(S.value),1),l("span",pt,k(w.value),1)],512))],64)):(c(),u("span",kt,"暂无歌词"))]))]}),_:1})]),l("div",_t,[t[0]||(t[0]=l("svg",{width:"120",height:"60",viewBox:"0 0 120 60",class:"shade"},[l("polygon",{points:"60,10 0,55 120,55"})],-1)),l("div",Ct,[L(R,{name:"fade"},{default:m(()=>{var e,s;return[(c(),u("div",{class:"light",key:(s=(e=r(o).songData)==null?void 0:e.track)==null?void 0:s.cover}))]}),_:1})]),t[1]||(t[1]=l("div",{class:"center"},null,-1)),t[2]||(t[2]=l("div",{class:"bottom"},null,-1))])]),t[3]||(t[3]=l("div",{class:"curb-container"},null,-1))],4)]),_:1}))}},zt=ut(St,[["__scopeId","data-v-3701cc83"]]);export{zt as default};
