var z=function(r,f){return r<f?-1:r>f?1:0},L=function(r){return r.reduce(function(f,p){return f+p},0)},T=(function(){function r(p){this.colors=p}var f=r.prototype;return f.palette=function(){return this.colors},f.map=function(p){return p},r})(),U=(function(){function r(e,t,u){return(e<<10)+(t<<5)+u}function f(e){var t=[],u=!1;function a(){t.sort(e),u=!0}return{push:function(o){t.push(o),u=!1},peek:function(o){return u||a(),o===void 0&&(o=t.length-1),t[o]},pop:function(){return u||a(),t.pop()},size:function(){return t.length},map:function(o){return t.map(o)},debug:function(){return u||a(),t}}}function p(e,t,u,a,o,n,c){var s=this;s.r1=e,s.r2=t,s.g1=u,s.g2=a,s.b1=o,s.b2=n,s.histo=c}function x(){this.vboxes=new f(function(e,t){return z(e.vbox.count()*e.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function y(e,t){if(t.count()){var u=t.r2-t.r1+1,a=t.g2-t.g1+1,o=Math.max.apply(null,[u,a,t.b2-t.b1+1]);if(t.count()==1)return[t.copy()];var n,c,s,l,m=0,g=[],k=[];if(o==u)for(n=t.r1;n<=t.r2;n++){for(l=0,c=t.g1;c<=t.g2;c++)for(s=t.b1;s<=t.b2;s++)l+=e[r(n,c,s)]||0;g[n]=m+=l}else if(o==a)for(n=t.g1;n<=t.g2;n++){for(l=0,c=t.r1;c<=t.r2;c++)for(s=t.b1;s<=t.b2;s++)l+=e[r(c,n,s)]||0;g[n]=m+=l}else for(n=t.b1;n<=t.b2;n++){for(l=0,c=t.r1;c<=t.r2;c++)for(s=t.g1;s<=t.g2;s++)l+=e[r(c,s,n)]||0;g[n]=m+=l}return g.forEach(function(C,h){k[h]=m-C}),(function(C){var h,d,v,w,b,_=C+"1",q=C+"2",E=0;for(n=t[_];n<=t[q];n++)if(g[n]>m/2){for(v=t.copy(),w=t.copy(),b=(h=n-t[_])<=(d=t[q]-n)?Math.min(t[q]-1,~~(n+d/2)):Math.max(t[_],~~(n-1-h/2));!g[b];)b++;for(E=k[b];!E&&g[b-1];)E=k[--b];return v[q]=b,w[_]=v[q]+1,[v,w]}})(o==u?"r":o==a?"g":"b")}}return p.prototype={volume:function(e){var t=this;return t._volume&&!e||(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(e){var t=this,u=t.histo;if(!t._count_set||e){var a,o,n,c=0;for(a=t.r1;a<=t.r2;a++)for(o=t.g1;o<=t.g2;o++)for(n=t.b1;n<=t.b2;n++)c+=u[r(a,o,n)]||0;t._count=c,t._count_set=!0}return t._count},copy:function(){var e=this;return new p(e.r1,e.r2,e.g1,e.g2,e.b1,e.b2,e.histo)},avg:function(e){var t=this,u=t.histo;if(!t._avg||e){var a,o,n,c,s=0,l=0,m=0,g=0;if(t.r1===t.r2&&t.g1===t.g2&&t.b1===t.b2)t._avg=[t.r1<<3,t.g1<<3,t.b1<<3];else{for(o=t.r1;o<=t.r2;o++)for(n=t.g1;n<=t.g2;n++)for(c=t.b1;c<=t.b2;c++)s+=a=u[r(o,n,c)]||0,l+=a*(o+.5)*8,m+=a*(n+.5)*8,g+=a*(c+.5)*8;t._avg=s?[~~(l/s),~~(m/s),~~(g/s)]:[~~(8*(t.r1+t.r2+1)/2),~~(8*(t.g1+t.g2+1)/2),~~(8*(t.b1+t.b2+1)/2)]}}return t._avg},contains:function(e){var t=this,u=e[0]>>3;return gval=e[1]>>3,bval=e[2]>>3,u>=t.r1&&u<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2}},x.prototype={push:function(e){this.vboxes.push({vbox:e,color:e.avg()})},palette:function(){return this.vboxes.map(function(e){return e.color})},size:function(){return this.vboxes.size()},map:function(e){for(var t=this.vboxes,u=0;u<t.size();u++)if(t.peek(u).vbox.contains(e))return t.peek(u).color;return this.nearest(e)},nearest:function(e){for(var t,u,a,o=this.vboxes,n=0;n<o.size();n++)((u=Math.sqrt(Math.pow(e[0]-o.peek(n).color[0],2)+Math.pow(e[1]-o.peek(n).color[1],2)+Math.pow(e[2]-o.peek(n).color[2],2)))<t||t===void 0)&&(t=u,a=o.peek(n).color);return a},forcebw:function(){var e=this.vboxes;e.sort(function(o,n){return z(L(o.color),L(n.color))});var t=e[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(e[0].color=[0,0,0]);var u=e.length-1,a=e[u].color;a[0]>251&&a[1]>251&&a[2]>251&&(e[u].color=[255,255,255])}},{quantize:function(e,t){if(!Number.isInteger(t)||t<1||t>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!e.length||t<2||t>256||!e.length||t<2||t>256)return!1;for(var u=[],a=new Set,o=0;o<e.length;o++){var n=e[o],c=n.join(",");a.has(c)||(a.add(c),u.push(n))}if(u.length<=t)return new T(u);var s=(function(h){var d,v=new Array(32768);return h.forEach(function(w){d=r(w[0]>>3,w[1]>>3,w[2]>>3),v[d]=(v[d]||0)+1}),v})(e);s.forEach(function(){});var l=(function(h,d){var v,w,b,_=1e6,q=0,E=1e6,M=0,D=1e6,P=0;return h.forEach(function(A){(v=A[0]>>3)<_?_=v:v>q&&(q=v),(w=A[1]>>3)<E?E=w:w>M&&(M=w),(b=A[2]>>3)<D?D=b:b>P&&(P=b)}),new p(_,q,E,M,D,P,d)})(e,s),m=new f(function(h,d){return z(h.count(),d.count())});function g(h,d){for(var v,w=h.size(),b=0;b<1e3;){if(w>=d||b++>1e3)return;if((v=h.pop()).count()){var _=y(s,v),q=_[0],E=_[1];if(!q)return;h.push(q),E&&(h.push(E),w++)}else h.push(v),b++}}m.push(l),g(m,.75*t);for(var k=new f(function(h,d){return z(h.count()*h.volume(),d.count()*d.volume())});m.size();)k.push(m.pop());g(k,t);for(var C=new x;k.size();)C.push(k.pop());return C}}})().quantize,N=function(r){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=r.naturalWidth,this.height=this.canvas.height=r.naturalHeight,this.context.drawImage(r,0,0,this.width,this.height)};N.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var I=function(){};I.prototype.getColor=function(r,f){return f===void 0&&(f=10),this.getPalette(r,5,f)[0]},I.prototype.getPalette=function(r,f,p){var x=(function(u){var a=u.colorCount,o=u.quality;if(a!==void 0&&Number.isInteger(a)){if(a===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");a=Math.max(a,2),a=Math.min(a,20)}else a=10;return(o===void 0||!Number.isInteger(o)||o<1)&&(o=10),{colorCount:a,quality:o}})({colorCount:f,quality:p}),y=new N(r),e=(function(u,a,o){for(var n,c,s,l,m,g=u,k=[],C=0;C<a;C+=o)c=g[0+(n=4*C)],s=g[n+1],l=g[n+2],((m=g[n+3])===void 0||m>=125)&&(c>250&&s>250&&l>250||k.push([c,s,l]));return k})(y.getImageData().data,y.width*y.height,x.quality),t=U(e,x.colorCount);return t?t.palette():null},I.prototype.getColorFromUrl=function(r,f,p){var x=this,y=document.createElement("img");y.addEventListener("load",function(){var e=x.getPalette(y,5,p);f(e[0],r)}),y.src=r},I.prototype.getImageData=function(r,f){var p=new XMLHttpRequest;p.open("GET",r,!0),p.responseType="arraybuffer",p.onload=function(){if(this.status==200){var x=new Uint8Array(this.response);i=x.length;for(var y=new Array(i),e=0;e<x.length;e++)y[e]=String.fromCharCode(x[e]);var t=y.join(""),u=window.btoa(t);f("data:image/png;base64,"+u)}},p.send()},I.prototype.getColorAsync=function(r,f,p){var x=this;this.getImageData(r,function(y){var e=document.createElement("img");e.addEventListener("load",function(){var t=x.getPalette(e,5,p);f(t[0],this)}),e.src=y})};const j=r=>r?r.includes("y.qq.com")?r.replace("https://y.qq.com/","/qq-proxy/"):r.includes("p3.music.126.net")?r.replace("http://p3.music.126.net/","/netease-proxy/"):r.includes("imge.kugou.com")?r.replace("http://imge.kugou.com/","/kugou-proxy/"):r.includes("img2.kuwo.cn")?r.replace("https://img2.kuwo.cn/","/kuwo-proxy/"):r.includes("p1.music.126.net")?r.replace("https://p1.music.126.net/","/p1-proxy/"):r.includes("p2.music.126.net")?r.replace("https://p2.music.126.net/","/p2-proxy/"):r:"";export{j as g,I as u};
