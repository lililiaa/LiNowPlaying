System.register([],function(t,r){"use strict";return{execute:function(){var r=function(t,r){return t<r?-1:t>r?1:0},n=function(t){return t.reduce(function(t,r){return t+r},0)},e=function(){function t(t){this.colors=t}var r=t.prototype;return r.palette=function(){return this.colors},r.map=function(t){return t},t}(),o=function(){function t(t,r,n){return(t<<10)+(r<<5)+n}function o(t){var r=[],n=!1;function e(){r.sort(t),n=!0}return{push:function(t){r.push(t),n=!1},peek:function(t){return n||e(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return n||e(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return n||e(),r}}}function u(t,r,n,e,o,u,i){var a=this;a.r1=t,a.r2=r,a.g1=n,a.g2=e,a.b1=o,a.b2=u,a.histo=i}function i(){this.vboxes=new o(function(t,n){return r(t.vbox.count()*t.vbox.volume(),n.vbox.count()*n.vbox.volume())})}function a(r,n){if(n.count()){var e=n.r2-n.r1+1,o=n.g2-n.g1+1,u=Math.max.apply(null,[e,o,n.b2-n.b1+1]);if(1==n.count())return[n.copy()];var i,a,c,s,f=0,h=[],l=[];if(u==e)for(i=n.r1;i<=n.r2;i++){for(s=0,a=n.g1;a<=n.g2;a++)for(c=n.b1;c<=n.b2;c++)s+=r[t(i,a,c)]||0;h[i]=f+=s}else if(u==o)for(i=n.g1;i<=n.g2;i++){for(s=0,a=n.r1;a<=n.r2;a++)for(c=n.b1;c<=n.b2;c++)s+=r[t(a,i,c)]||0;h[i]=f+=s}else for(i=n.b1;i<=n.b2;i++){for(s=0,a=n.r1;a<=n.r2;a++)for(c=n.g1;c<=n.g2;c++)s+=r[t(a,c,i)]||0;h[i]=f+=s}return h.forEach(function(t,r){l[r]=f-t}),function(t){var r,e,o,u,a,c=t+"1",s=t+"2",p=0;for(i=n[c];i<=n[s];i++)if(h[i]>f/2){for(o=n.copy(),u=n.copy(),a=(r=i-n[c])<=(e=n[s]-i)?Math.min(n[s]-1,~~(i+e/2)):Math.max(n[c],~~(i-1-r/2));!h[a];)a++;for(p=l[a];!p&&h[a-1];)p=l[--a];return o[s]=a,u[c]=o[s]+1,[o,u]}}(u==e?"r":u==o?"g":"b")}}return u.prototype={volume:function(t){var r=this;return r._volume&&!t||(r._volume=(r.r2-r.r1+1)*(r.g2-r.g1+1)*(r.b2-r.b1+1)),r._volume},count:function(r){var n=this,e=n.histo;if(!n._count_set||r){var o,u,i,a=0;for(o=n.r1;o<=n.r2;o++)for(u=n.g1;u<=n.g2;u++)for(i=n.b1;i<=n.b2;i++)a+=e[t(o,u,i)]||0;n._count=a,n._count_set=!0}return n._count},copy:function(){var t=this;return new u(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(r){var n=this,e=n.histo;if(!n._avg||r){var o,u,i,a,c=0,s=0,f=0,h=0;if(n.r1===n.r2&&n.g1===n.g2&&n.b1===n.b2)n._avg=[n.r1<<3,n.g1<<3,n.b1<<3];else{for(u=n.r1;u<=n.r2;u++)for(i=n.g1;i<=n.g2;i++)for(a=n.b1;a<=n.b2;a++)c+=o=e[t(u,i,a)]||0,s+=o*(u+.5)*8,f+=o*(i+.5)*8,h+=o*(a+.5)*8;n._avg=c?[~~(s/c),~~(f/c),~~(h/c)]:[~~(8*(n.r1+n.r2+1)/2),~~(8*(n.g1+n.g2+1)/2),~~(8*(n.b1+n.b2+1)/2)]}}return n._avg},contains:function(t){var r=this,n=t[0]>>3;return gval=t[1]>>3,bval=t[2]>>3,n>=r.r1&&n<=r.r2&&gval>=r.g1&&gval<=r.g2&&bval>=r.b1&&bval<=r.b2}},i.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var r=this.vboxes,n=0;n<r.size();n++)if(r.peek(n).vbox.contains(t))return r.peek(n).color;return this.nearest(t)},nearest:function(t){for(var r,n,e,o=this.vboxes,u=0;u<o.size();u++)((n=Math.sqrt(Math.pow(t[0]-o.peek(u).color[0],2)+Math.pow(t[1]-o.peek(u).color[1],2)+Math.pow(t[2]-o.peek(u).color[2],2)))<r||void 0===r)&&(r=n,e=o.peek(u).color);return e},forcebw:function(){var t=this.vboxes;t.sort(function(t,e){return r(n(t.color),n(e.color))});var e=t[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(t[0].color=[0,0,0]);var o=t.length-1,u=t[o].color;u[0]>251&&u[1]>251&&u[2]>251&&(t[o].color=[255,255,255])}},{quantize:function(n,c){if(!Number.isInteger(c)||c<1||c>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!n.length||c<2||c>256)return!1;if(!n.length||c<2||c>256)return!1;for(var s=[],f=new Set,h=0;h<n.length;h++){var l=n[h],p=l.join(",");f.has(p)||(f.add(p),s.push(l))}if(s.length<=c)return new e(s);var g=function(r){var n,e=new Array(32768);return r.forEach(function(r){n=t(r[0]>>3,r[1]>>3,r[2]>>3),e[n]=(e[n]||0)+1}),e}(n);g.forEach(function(){});var v=function(t,r){var n,e,o,i=1e6,a=0,c=1e6,s=0,f=1e6,h=0;return t.forEach(function(t){(n=t[0]>>3)<i?i=n:n>a&&(a=n),(e=t[1]>>3)<c?c=e:e>s&&(s=e),(o=t[2]>>3)<f?f=o:o>h&&(h=o)}),new u(i,a,c,s,f,h,r)}(n,g),m=new o(function(t,n){return r(t.count(),n.count())});function b(t,r){for(var n,e=t.size(),o=0;o<1e3;){if(e>=r)return;if(o++>1e3)return;if((n=t.pop()).count()){var u=a(g,n),i=u[0],c=u[1];if(!i)return;t.push(i),c&&(t.push(c),e++)}else t.push(n),o++}}m.push(v),b(m,.75*c);for(var d=new o(function(t,n){return r(t.count()*t.volume(),n.count()*n.volume())});m.size();)d.push(m.pop());b(d,c);for(var w=new i;d.size();)w.push(d.pop());return w}}}().quantize,u=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=t.naturalWidth,this.height=this.canvas.height=t.naturalHeight,this.context.drawImage(t,0,0,this.width,this.height)};u.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var a=t("u",function(){});a.prototype.getColor=function(t,r){return void 0===r&&(r=10),this.getPalette(t,5,r)[0]},a.prototype.getPalette=function(t,r,n){var e=function(t){var r=t.colorCount,n=t.quality;if(void 0!==r&&Number.isInteger(r)){if(1===r)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");r=Math.max(r,2),r=Math.min(r,20)}else r=10;return(void 0===n||!Number.isInteger(n)||n<1)&&(n=10),{colorCount:r,quality:n}}({colorCount:r,quality:n}),i=new u(t),a=function(t,r,n){for(var e,o,u,i,a,c=t,s=[],f=0;f<r;f+=n)o=c[0+(e=4*f)],u=c[e+1],i=c[e+2],(void 0===(a=c[e+3])||a>=125)&&(o>250&&u>250&&i>250||s.push([o,u,i]));return s}(i.getImageData().data,i.width*i.height,e.quality),c=o(a,e.colorCount);return c?c.palette():null},a.prototype.getColorFromUrl=function(t,r,n){var e=this,o=document.createElement("img");o.addEventListener("load",function(){var u=e.getPalette(o,5,n);r(u[0],t)}),o.src=t},a.prototype.getImageData=function(t,r){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){if(200==this.status){var t=new Uint8Array(this.response);i=t.length;for(var n=new Array(i),e=0;e<t.length;e++)n[e]=String.fromCharCode(t[e]);var o=n.join(""),u=window.btoa(o);r("data:image/png;base64,"+u)}},n.send()},a.prototype.getColorAsync=function(t,r,n){var e=this;this.getImageData(t,function(t){var o=document.createElement("img");o.addEventListener("load",function(){var t=e.getPalette(o,5,n);r(t[0],this)}),o.src=t})},t("g",function(t){return t?t.includes("y.qq.com")?t.replace("https://y.qq.com/","/qq-proxy/"):t.includes("p3.music.126.net")?t.replace("http://p3.music.126.net/","/netease-proxy/"):t.includes("imge.kugou.com")?t.replace("http://imge.kugou.com/","/kugou-proxy/"):t.includes("img2.kuwo.cn")?t.replace("https://img2.kuwo.cn/","/kuwo-proxy/"):t.includes("p1.music.126.net")?t.replace("https://p1.music.126.net/","/p1-proxy/"):t.includes("p2.music.126.net")?t.replace("https://p2.music.126.net/","/p2-proxy/"):t:""})}}});
