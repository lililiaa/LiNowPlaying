import{bS as Z,r as h,w as V,c as tt,av as et,o as at,cp as ot,N as z,B as m,u as r,cl as st,s as c,v as l,x as nt,an as it,A as L,ap as rt,aq as R,p as u,q as x,X,V as k,O as lt}from"./index-rwlLbiDS.js";import{o as J}from"./overflowText-CMclQLYt.js";import{T as ct}from"./v-scale-screen-lCa8Oxx2.js";import{g as dt,u as ht}from"./cover-DzIuO3oK.js";import{_ as ut}from"./plugin-vueexport-helper-DlAUqK2U.js";const gt={class:"surface-container"},mt={class:"rain-container"},vt={key:1,class:"separate"},yt={key:3},ft={class:"original"},pt={class:"translated"},kt={key:1,class:"lyric-empty"},_t={class:"street-light"},bt={class:"top"},U="80px",Ct="65px",Y="50px",Dt={__name:"rain",setup(St){st(e=>({"072ebbb2":U,"26db04ee":Ct,f48be724:Y}));const o=Z(),I=h(localStorage.getItem("backgroundColor")||"rgba(0, 0, 0, 0.8)"),v=h(localStorage.getItem("textColor")||"rgba(255, 255, 255, 1)"),B=h(localStorage.getItem("shadowColor")||"rgba(255, 255, 255, 1)"),N=h([]);class G{constructor(t,a){this.canvasWidth=t,this.canvasHeight=a,this.reset()}reset(){this.y=Math.random()*-this.canvasHeight,g.value.angle>=0?this.x=(Math.random()*1.2-.2)*this.canvasWidth:this.x=Math.random()*1.2*this.canvasWidth,this.length=Math.random()*10+30,this.width=Math.random()*1+3,this.speedFactor=Math.random()*.5+.7}update(t,a){const s=t*Math.PI/180,i=Math.sin(s)*a,n=Math.cos(s)*a*this.speedFactor;this.x+=i,this.y+=n,this.y>this.canvasHeight+30&&this.reset()}draw(t,a){const s=a*Math.PI/180,i=this.x-Math.sin(s)*this.length,n=this.y-Math.cos(s)*this.length,d=t.createLinearGradient(this.x,this.y,i,n);d.addColorStop(0,I.value),d.addColorStop(1,"rgba(255, 255, 255, 0)"),t.beginPath(),t.moveTo(this.x,this.y),t.lineTo(i,n),t.strokeStyle=d,t.lineWidth=this.width,t.stroke()}}const y=h(null);let M=null,_=[],b=null;const g=h(JSON.parse(localStorage.getItem("rainConfig")||{isRain:!0,amount:100,angle:0,speed:10})),K=()=>{var a,s;const e=new ht,t=new Image;t.src=dt((s=(a=o.songData)==null?void 0:a.track)==null?void 0:s.cover),t.onload=function(){const i=e.getColor(t);I.value="rgba(".concat(i.join(","),", 1)"),v.value="rgba(".concat(i.map(n=>255-n).join(","),", 1)"),B.value="rgba(".concat(i.map(n=>255-n).join(","),", 1)"),N.value=e.getPalette(t).map(n=>"rgba(".concat(n.join(","),", 1)"))}};JSON.parse(localStorage.getItem("isCustomColor"))||V(()=>{var e,t;return(t=(e=o.songData)==null?void 0:e.track)==null?void 0:t.cover},(e,t)=>{e&&e!==t&&K()});const C=tt(()=>{var s,i;const e=((i=(s=o.songData)==null?void 0:s.player)==null?void 0:i.seekbarCurrentPositionHuman.split(":"))||0,t=parseInt(e[0])*60+parseInt(e[1]);let a=-1;for(let n=o.lyricData.lyric.length-1;n>=0;n--){const d=o.lyricData.lyric[n][1].match(/\[(\d+):(\d+)\.(\d+)\]/);if(d){const w=parseInt(d[1])*60+parseInt(d[2]);if(t>=w){a=n;break}}}return a}),D=h(""),S=h(""),F=h(null);V(C,(e,t)=>{if(o.lyricData.translatedLyric.length>0)if(e===-1)D.value="",S.value="";else{let a=o.lyricData.lyric[e][1],s=o.lyricData.translatedLyric.find(i=>i[1]===a);s&&s[2]?(S.value=s[2],D.value=o.lyricData.lyric[e][2]):(S.value=o.lyricData.lyric[e][2],D.value="")}}),et({status:"已暂停",name:"暂无歌曲"}),at(()=>{o.resetSongData();const e=y.value;M=e.getContext("2d"),T(e),Q(e),b=requestAnimationFrame(H);let t=null;window.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>{T(y.value)},200)})}),ot(()=>{b&&cancelAnimationFrame(b),window.removeEventListener("resize",()=>T(y.value))});function T(e){let t=document.querySelector(".rain-container");e.width=t.clientWidth,e.height=t.clientHeight,_.forEach(a=>{a.canvasWidth=e.width,a.canvasHeight=e.height})}function Q(e){_=[];for(let t=0;t<g.value.amount;t++)_.push(new G(e.width,e.height))}function H(){const e=y.value;M.clearRect(0,0,e.width,e.height),_.forEach(t=>{t.update(g.value.angle,g.value.speed),t.draw(M,g.value.angle)}),b=requestAnimationFrame(H)}return(e,t)=>(c(),z(r(ct),{width:1900,height:800,"box-style":{backgroundColor:"none"}},{default:m(()=>[l("div",{class:"main",style:nt({"--theme-color":I.value,"--text-color":v.value,"--bg-color":N.value[2]||v.value,"--shadow-color":B.value})},[l("div",gt,[l("div",mt,[it(l("canvas",{id:"rainCanvas",ref_key:"rainCanvas",ref:y},null,512),[[rt,g.value.isRain]]),L(R,{name:"lyric",mode:"out-in"},{default:m(()=>{var a,s,i,n,d,w,W,q,E,P,j,A,$,O;return[(c(),u("div",{class:"song-container",key:(s=(a=r(o).songData)==null?void 0:a.track)==null?void 0:s.title},[(n=(i=r(o).songData)==null?void 0:i.track)!=null&&n.title?(c(),z(J,{key:0,color:v.value,"font-size":U,"is-bold":"bold"},{default:m(()=>{var f,p;return[X(k((p=(f=r(o).songData)==null?void 0:f.track)==null?void 0:p.title),1)]}),_:1},8,["color"])):x("",!0),(w=(d=r(o).songData)==null?void 0:d.track)!=null&&w.title&&((q=(W=r(o).songData)==null?void 0:W.track)!=null&&q.author)?(c(),u("span",vt,"-")):x("",!0),(P=(E=r(o).songData)==null?void 0:E.track)!=null&&P.author?(c(),z(J,{key:2,color:v.value,"font-size":Y,"is-bold":"bold"},{default:m(()=>{var f,p;return[X(k((p=(f=r(o).songData)==null?void 0:f.track)==null?void 0:p.author),1)]}),_:1},8,["color"])):x("",!0),!((A=(j=r(o).songData)==null?void 0:j.track)!=null&&A.title)&&!((O=($=r(o).songData)==null?void 0:$.track)!=null&&O.author)?(c(),u("span",yt,"暂无歌曲信息")):x("",!0)]))]}),_:1}),L(R,{name:"lyric",mode:"out-in"},{default:m(()=>{var a;return[(c(),u("div",{class:"lyric-container",key:C.value},[r(o).lyricData.lyric.length>0?(c(),u(lt,{key:0},[r(o).lyricData.translatedLyric.length===0?(c(),u("span",{key:0,ref_key:"lyricRef",ref:F,class:"lyric-line"},k(((a=r(o).lyricData.lyric[C.value])==null?void 0:a.length)>0&&r(o).lyricData.lyric[C.value][2]||"......"),513)):(c(),u("div",{key:1,ref_key:"lyricRef",ref:F,class:"lyric-line-translated"},[l("span",ft,k(D.value),1),l("span",pt,k(S.value),1)],512))],64)):(c(),u("span",kt,"暂无歌词"))]))]}),_:1})]),l("div",_t,[t[0]||(t[0]=l("svg",{width:"120",height:"60",viewBox:"0 0 120 60",class:"shade"},[l("polygon",{points:"60,10 0,55 120,55"})],-1)),l("div",bt,[L(R,{name:"fade"},{default:m(()=>{var a,s;return[(c(),u("div",{class:"light",key:(s=(a=r(o).songData)==null?void 0:a.track)==null?void 0:s.cover}))]}),_:1})]),t[1]||(t[1]=l("div",{class:"center"},null,-1)),t[2]||(t[2]=l("div",{class:"bottom"},null,-1))])]),t[3]||(t[3]=l("div",{class:"curb-container"},null,-1))],4)]),_:1}))}},zt=ut(Dt,[["__scopeId","data-v-12973e57"]]);export{zt as default};
